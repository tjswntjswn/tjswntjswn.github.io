<div id="search-modal" class="search-modal">
    <div class="search-content">
        <div class="search-header">
            <input type="text" id="search-input" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì œëª©, íƒœê·¸...)" autocomplete="off">
            <button onclick="closeSearch()" class="btn-close-search">âœ•</button>
        </div>
        <div id="search-results" class="search-results">
            </div>
    </div>
</div>

<script>
    let posts = [];

    // 1. ê²€ìƒ‰ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ì²˜ìŒ í•œ ë²ˆë§Œ ë¡œë”©)
    fetch('{{ "/search.json" | relative_url }}')
        .then(response => response.json())
        .then(data => { posts = data; })
        .catch(err => console.error("ê²€ìƒ‰ ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:", err));

    // 2. ê²€ìƒ‰ì°½ ì—´ê¸°/ë‹«ê¸°
    function openSearch() {
        document.getElementById('search-modal').style.display = 'flex';
        document.getElementById('search-input').focus();
        document.body.style.overflow = 'hidden'; // ìŠ¤í¬ë¡¤ ë§‰ê¸°
    }

    function closeSearch() {
        document.getElementById('search-modal').style.display = 'none';
        document.getElementById('search-input').value = '';
        document.getElementById('search-results').innerHTML = '';
        document.body.style.overflow = 'auto'; // ìŠ¤í¬ë¡¤ í’€ê¸°
    }

    // 3. ì‹¤ì‹œê°„ ê²€ìƒ‰ ë¡œì§ (ê¸€ì ì¹  ë•Œë§ˆë‹¤ ì‹¤í–‰)
    document.getElementById('search-input').addEventListener('keyup', function(e) {
        const query = e.target.value.toLowerCase();
        const resultsContainer = document.getElementById('search-results');
        resultsContainer.innerHTML = ''; // ê¸°ì¡´ ê²°ê³¼ ì§€ìš°ê¸°

        if (query.length < 1) return; // í•œ ê¸€ì ë¯¸ë§Œì´ë©´ ê²€ìƒ‰ ì•ˆ í•¨

        // ì œëª©, ì¹´í…Œê³ ë¦¬, íƒœê·¸ ì¤‘ì—ì„œ ê²€ìƒ‰ì–´ ì°¾ê¸°
        const filtered = posts.filter(post => {
            return post.title.toLowerCase().includes(query) || 
                   post.category.toLowerCase().includes(query) ||
                   post.tags.toLowerCase().includes(query);
        });

        // ê²°ê³¼ í™”ë©´ì— ë¿Œë¦¬ê¸°
        if (filtered.length > 0) {
            filtered.forEach(post => {
                const item = `
                    <a href="${post.url}" class="search-item">
                        <span class="search-date">${post.date}</span>
                        <h3 class="search-title">${post.title}</h3>
                        <span class="search-meta">ğŸ“‚ ${post.category}</span>
                    </a>
                `;
                resultsContainer.innerHTML += item;
            });
        } else {
            resultsContainer.innerHTML = '<p class="no-result">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ì–´ìš” ğŸ¥²</p>';
        }
    });

    // ESC í‚¤ ëˆ„ë¥´ë©´ ë‹«ê¸°
    window.addEventListener('keydown', function(e) {
        if (e.key === "Escape") closeSearch();
    });
</script>