<!-- ê²€ìƒ‰ ëª¨ë‹¬(Search Modal) -->
<div id="search-modal" class="search-modal">
    <!-- ê²€ìƒ‰ ì˜ì—­ ì»¨í…Œì´ë„ˆ -->
    <div class="search-content">
        <!-- ê²€ìƒ‰ ì…ë ¥ì°½ + ë‹«ê¸° ë²„íŠ¼ -->
        <div class="search-header">
            <!-- ê²€ìƒ‰ì–´ ì…ë ¥ -->
            <input type="text" id="search-input" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì œëª©, íƒœê·¸...)" autocomplete="off">
            <!-- ê²€ìƒ‰ ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼ -->
            <button onclick="closeSearch()" class="btn-close-search">âœ•</button>
        </div>
        <!-- ê²€ìƒ‰ ê²°ê³¼ ì¶œë ¥ ì˜ì—­ -->
        <div id="search-results" class="search-results"></div>
    </div>
</div>

<script>
    // ì „ì²´ ê²Œì‹œê¸€ ëª©ë¡ì„ ì €ì¥í•  ë°°ì—´
    let posts = [];

    /* 1. ê²€ìƒ‰ ë°ì´í„° ë¡œë”© (ì´ˆê¸° 1íšŒ) */
    // search.json íŒŒì¼ì—ì„œ ê²Œì‹œê¸€ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    fetch('{{"/search.json" | relative_url}}')
        .then(response => response.json())
        .then(data => {
            posts = data; // ê°€ì ¸ì˜¨ ë°ì´í„°ë¥¼ ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
        })
        .catch(err => console.error("ê²€ìƒ‰ ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:", err));

    /* 2. ê²€ìƒ‰ ëª¨ë‹¬ ì—´ê¸° / ë‹«ê¸° */
    // ê²€ìƒ‰ ëª¨ë‹¬ ì—´ê¸°
    function openSearch() {
        document.getElementById('search-modal').style.display = 'flex';
        document.getElementById('search-input').focus(); // ì…ë ¥ì°½ í¬ì»¤ìŠ¤
        document.body.style.overflow = 'hidden'; // ë°°ê²½ ìŠ¤í¬ë¡¤ ë§‰ê¸°
    }

    // ê²€ìƒ‰ ëª¨ë‹¬ ë‹«ê¸° ë° ìƒíƒœ ì´ˆê¸°í™”
    function closeSearch() {
        document.getElementById('search-modal').style.display = 'none';
        document.getElementById('search-input').value = ''; // ì…ë ¥ê°’ ì´ˆê¸°í™”
        document.getElementById('search-results').innerHTML = ''; // ê²°ê³¼ ì´ˆê¸°í™”
        document.body.style.overflow = 'auto'; // ë°°ê²½ ìŠ¤í¬ë¡¤ ë³µêµ¬
    }

    /* 3. ì‹¤ì‹œê°„ ê²€ìƒ‰ ë¡œì§ */
    // ì…ë ¥ì°½ì—ì„œ í‚¤ë¥¼ ëˆ„ë¥¼ ë•Œë§ˆë‹¤ ì‹¤í–‰
    document.getElementById('search-input').addEventListener('keyup', function(e) {
        const query = e.target.value.toLowerCase(); // ì…ë ¥ëœ ê²€ìƒ‰ì–´
        const resultsContainer = document.getElementById('search-results');

        // ì´ì „ ê²€ìƒ‰ ê²°ê³¼ ì œê±°
        resultsContainer.innerHTML = '';
        // í•œ ê¸€ì ë¯¸ë§Œì´ë©´ ê²€ìƒ‰í•˜ì§€ ì•ŠìŒ
        if(query.length < 1) return;

        // ì œëª© / ì¹´í…Œê³ ë¦¬ / íƒœê·¸ ì¤‘ ê²€ìƒ‰ì–´ í¬í•¨ ì—¬ë¶€ í™•ì¸
        const filtered = posts.filter(post => {
            return post.title.toLowerCase().includes(query) || post.category.toLowerCase().includes(query) || post.tags.toLowerCase().includes(query);
        });

        // ê²€ìƒ‰ ê²°ê³¼ ë Œë”ë§
        if(filtered.length > 0) {
            filtered.forEach(post => {
                const item = `
                    <a href="${post.url}" class="search-item">
                        <span class="search-date">${post.date}</span>
                        <h3 class="search-title">${post.title}</h3>
                        <span class="search-meta">ğŸ“‚ ${post.category}</span>
                    </a>
                `;
                resultsContainer.innerHTML += item;
            });
        } else {
            // ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ
            resultsContainer.innerHTML = '<p class="no-result">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ì–´ìš” ğŸ¥²</p>';
        }
    });

    /* 4. í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ */
    // ESC í‚¤ë¥¼ ëˆ„ë¥´ë©´ ê²€ìƒ‰ ëª¨ë‹¬ ë‹«ê¸°
    window.addEventListener('keydown', function(e) {
        if(e.key === "Escape") {
            closeSearch();
        }
    });
</script>    