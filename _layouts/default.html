<!DOCTYPE html>
<html lang="ko">
    <head>
        <!-- âœ… ëª¨ë°”ì¼ì—ì„œ í™”ë©´ í­ì„ ê¸°ê¸° í­ìœ¼ë¡œ ë§ì¶¤ (ë°˜ì‘í˜• í•„ìˆ˜) -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!-- âœ… (ì„ íƒ) êµ¬ê¸€ ì• ë„ë¦¬í‹±ìŠ¤: site.google_analytics ê°’ì´ ìˆì„ ë•Œë§Œ ì‚½ì… -->
        {%if site.google_analytics%}
        <script async src="https://www.googletagmanager.com/gtag/js?id={{site.google_analytics}}"></script>
        <script>
        // GA ê¸°ë³¸ ì„¤ì •
        window.dataLayer=window.dataLayer||[];
        function gtag() {dataLayer.push(arguments);}
        gtag('js',new Date());
        gtag('config','{{site.google_analytics}}');
        </script>
        {%endif%}

        <!-- âœ… ë¬¸ì„œ ë¬¸ì ì¸ì½”ë”© -->
        <meta charset="UTF-8">

        <!-- âœ… í˜ì´ì§€ íƒ€ì´í‹€: page.title ì—†ìœ¼ë©´ site.title ì‚¬ìš© -->
        <title>{{page.title | default: site.title}}</title>

        <!-- âœ… íŒŒë¹„ì½˜ -->
        <link rel="icon" type="image/png" href="{{'/assets/img/favicon.png' | relative_url}}">

        <!-- âœ… Main Style -->
        <link rel="stylesheet" href="{{'/css/main.css' | relative_url}}">

        <!-- âœ… ì•„ì´ì½˜ í°íŠ¸(Font Awesome) -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

        <!-- âœ… Open Graph (ì¹´í†¡/í˜ë¶/ë””ìŠ¤ì½”ë“œ ê³µìœ  ë¯¸ë¦¬ë³´ê¸°ìš©) -->
        <meta property="og:site_name" content="{{site.profile.name}}">
        <meta property="og:type" content="{%if page.layout=='post'%}article{%else%}website{%endif%}">
        <meta property="og:title" content="{{page.title|default:site.title}}">
        <meta property="og:url" content="{{page.url|absolute_url}}">
        <meta property="og:description" content="{{page.excerpt|default:site.profile.description|strip_html|strip_newlines|truncate:160}}">

        <!-- âœ… OG ì´ë¯¸ì§€: ê¸°ë³¸ì€ í”„ë¡œí•„ ì´ë¯¸ì§€, ê¸€ì— page.imageê°€ ìˆìœ¼ë©´ ê·¸ê±¸ ìš°ì„  -->
        {%assign og_image = site.profile.image|absolute_url%}
        {%if page.image%}{%assign og_image = page.image|absolute_url%}{%endif%}
        <meta property="og:image" content="{{og_image}}">

        <!-- âœ… Twitter ì¹´ë“œ(íŠ¸ìœ„í„° ê³µìœ  ë¯¸ë¦¬ë³´ê¸°ìš©) -->
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="{{page.title|default:site.title}}">
        <meta name="twitter:description" content="{{page.excerpt|default:site.profile.description|strip_html|truncate:160}}">
        <meta name="twitter:image" content="{{og_image}}">

        <!-- âœ… í•´ì‹œ(#ì¹´í…Œê³ ë¦¬ ë“±)ë¡œ ì§„ì…í•  ë•Œ ê¹œë¹¡ì„/ë ˆì´ì•„ì›ƒ ê¹¨ì§ ë°©ì§€ìš© -->
        <style>
            /* filtering-modeê°€ ë¶™ì–´ ìˆìœ¼ë©´ ì ê¹ ìˆ¨ê²¼ë‹¤ê°€ */
            html.filtering-mode body { opacity: 0; visibility: hidden; }
            /* 0.2ì´ˆ ì •ë„ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ë‚˜íƒ€ë‚˜ê²Œ */
            body { transition: opacity 0.2s ease-in-out; opacity: 1; visibility: visible; }
        </style>
        <script>
            // URLì— #something ì´ ìˆìœ¼ë©´ (ì¹´í…Œê³ ë¦¬ í•„í„° ê°™ì€ ì¼€ì´ìŠ¤)
            // í˜ì´ì§€ ë¡œë“œ ì´ˆë°˜ì— bodyë¥¼ ì ê¹ ìˆ¨ê¹€ ì²˜ë¦¬
            if(window.location.hash && window.location.hash.length > 1) {
                document.documentElement.classList.add('filtering-mode');
            }
        </script>
    </head>
    <body data-p-cat="{{page.categories[0]}}" data-s-cat="{{page.categories[1]}}">
        <!-- âœ… ë§¨ ìœ„ë¡œ ê°€ê¸° ë²„íŠ¼ (ìŠ¤íƒ€ì¼ì€ ì¸ë¼ì¸ë¡œ ë°•í˜€ ìˆìŒ) -->
        <a id="btn-back-to-top" href="#" style="display: none; position: fixed; bottom: 30px; right: 30px; width: 50px; height: 50px; background-color: #FBC02D; color: #5D4037; border-radius: 50%; box-shadow: 0 4px 10px rgba(0,0,0,0.3); text-align: center; line-height: 50px; font-size: 24px; font-weight: bold; z-index: 2147483647; border: 2px solid #fff; text-decoration: none;">â†‘</a>

        <!-- âœ… ë°©ë¬¸ì ì¹´ìš´í„°(busuanzi) ìŠ¤í¬ë¦½íŠ¸ -->
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

        <!-- âœ… ì´ë¯¸ì§€ í™•ëŒ€(ë¼ì´íŠ¸ë°•ìŠ¤) ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
        <script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script>

        <!-- âœ… í­ì£½/ì»¨í˜í‹° íš¨ê³¼ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
        <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

        <script>
            // âœ… DOM ë¡œë”© ëë‚œ ë’¤ì— ê¸°ëŠ¥ë“¤ ì´ˆê¸°í™”
            document.addEventListener("DOMContentLoaded", function() {
                /* 1) ì´ë¯¸ì§€ í™•ëŒ€ (medium-zoom) */
                mediumZoom('.post-body img', {margin: 24, background: 'rgba(0,0,0,0.8)'});

                /* 2) ë§¨ ìœ„ë¡œ ê°€ê¸° ë²„íŠ¼ - ìŠ¤í¬ë¡¤ 200px ë„˜ì–´ê°€ë©´ í‘œì‹œ, í´ë¦­í•˜ë©´ ìŠ¤ë¬´ìŠ¤ ìŠ¤í¬ë¡¤ë¡œ top ì´ë™ */
                const backToTopBtn = document.getElementById("btn-back-to-top");
                if(backToTopBtn) {
                    window.addEventListener("scroll", function() {
                        if(window.scrollY > 200) backToTopBtn.style.display = "block";
                        else backToTopBtn.style.display = "none";
                    });
                    backToTopBtn.addEventListener("click", function(e) {
                        e.preventDefault();
                        window.scrollTo({top: 0, behavior: 'smooth'});
                    });
                }

                /* 3) ëŒ“ê¸€ ìˆ˜ í‘œì‹œ (GitHub Issues API) - repo ì´ìŠˆ ëª©ë¡ì„ ê°€ì ¸ì™€ì„œ ê¸€ url/title ê¸°ë°˜ìœ¼ë¡œ ë§¤ì¹­ í›„ ëŒ“ê¸€ ìˆ˜ ì¶œë ¥ */
                const repo = "tjswntjswn/tjswntjswn.github.io";

                // ë¬¸ìì—´ ì •ê·œí™”: ê³µë°±/ìŠ¬ë˜ì‹œ ì œê±°, .html ì œê±°, ì†Œë¬¸ìí™”
                function normalize(text) {
                    return text ? decodeURIComponent(text).replace(/\s+/g, "").replace(/\//g, "").replace(/\.html$/g, "").toLowerCase() : "";
                }

                fetch(`https://api.github.com/repos/${repo}/issues?per_page=100`)
                    .then(r => r.json())
                    .then(d => {
                        // title -> comments ë§¤í•‘ í…Œì´ë¸”
                        const m = {};
                        if(Array.isArray(d)) d.forEach(i => m[normalize(i.title)]=i.comments);

                        // .comment-cnt-target ìš”ì†Œë“¤ì— ëŒ“ê¸€ ìˆ˜ ì£¼ì…
                        document.querySelectorAll(".comment-cnt-target").forEach(e => {
                            const u = normalize(e.getAttribute("data-url"));
                            const t = normalize(e.getAttribute("data-title"));

                            // url ê¸°ì¤€ ìš°ì„ , ì—†ìœ¼ë©´ title ê¸°ì¤€
                            let c = m[u] !== undefined ? m[u] : (m[t] !== undefined ? m[t] : 0);

                            e.innerHTML=`ğŸ’¬ ${c}`;
                            if(c > 0) e.style.fontWeight = "bold";
                            e.style.opacity = 1; // ì²˜ìŒì—” ìˆ¨ê²¨ë‘” ê±° í‘œì‹œ
                        });
                    })
                    .catch(e=>console.log("ëŒ“ê¸€ ë¡œë”© ì‹¤íŒ¨:", e));

                /* 4) ì‚¬ì´ë“œë°” ì¹´í…Œê³ ë¦¬ í•˜ì´ë¼ì´íŠ¸ - í˜„ì¬ hash(#ì¹´í…Œê³ ë¦¬) ë˜ëŠ” page.categories ê¸°ë°˜ìœ¼ë¡œ í•´ë‹¹ ë§í¬ì— active-category í´ë˜ìŠ¤ ë¶€ì—¬ */
                function highlightSidebar() {
                    // ê¸°ì¡´ active ì œê±°
                    document.querySelectorAll('.category-tree a').forEach(a=>a.classList.remove('active-category'));

                    // í•´ì‹œ(#...)ê°€ ìˆìœ¼ë©´ ê·¸ê±¸ ìš°ì„  ì‚¬ìš©
                    const h = decodeURIComponent(window.location.hash).replace('#', '');

                    // ê¸€ ì¹´í…Œê³ ë¦¬(ë¶€ëª¨/ìì‹)ë¥¼ body data-*ì—ì„œ ê°€ì ¸ì˜´
                    const p = document.body.getAttribute('data-p-cat');
                    const s = document.body.getAttribute('data-s-cat');

                    // ìš°ì„ ìˆœìœ„: hash > sub category > parent category
                    let t = h ? h : (s ? s : p);

                    // ë§í¬ hrefì— '#t'ê°€ í¬í•¨ë˜ë©´ active ì²˜ë¦¬
                    if(t) {
                        document.querySelectorAll('.category-tree a').forEach(a => {
                            if(decodeURIComponent(a.getAttribute('href')).includes('#' + t)) {
                                a.classList.add('active-category');
                            }
                        });
                    }
                }
                highlightSidebar();
                window.addEventListener('hashchange', highlightSidebar);

                /* 5) ì½”ë“œ ë³µì‚¬ ë²„íŠ¼ ìƒì„± - pre.highlightë§ˆë‹¤ Copy ë²„íŠ¼ ë¶™ì„ */
                document.querySelectorAll('pre.highlight').forEach(pre => {
                    var btn=document.createElement('button');
                    btn.className='btn-copy-code';
                    btn.textContent='Copy';

                    btn.addEventListener('click', function() {
                        navigator.clipboard.writeText(pre.querySelector('code').innerText).then(() => {
                            btn.textContent = 'Copied! âœ¨';
                            setTimeout(() => btn.textContent='Copy', 2000);
                        });
                    });

                    // ë²„íŠ¼ì„ preì˜ ë¶€ëª¨ì— ë¶™ì„ (ë ˆì´ì•„ì›ƒì— ë”°ë¼ ì¡°ì • ê°€ëŠ¥)
                    if(pre.parentNode) pre.parentNode.appendChild(btn);
                });

                /* 6) ê³µìœ í•˜ê¸° ê¸°ëŠ¥(ì£¼ì†Œ ë³µì‚¬) - window.copyLink()ë¡œ ì™¸ë¶€ ë²„íŠ¼ì—ì„œ í˜¸ì¶œ ê°€ëŠ¥, ë³µì‚¬ ì„±ê³µ ì‹œ í† ìŠ¤íŠ¸(#toast-msg) ë³´ì—¬ì¤Œ */
                window.copyLink = function() {
                    const url = window.location.href;
                    navigator.clipboard.writeText(url).then(function() {
                        const toast = document.getElementById("toast-msg");
                        if(toast) {
                            toast.className = "show";
                            setTimeout(function() {
                                toast.className = toast.className.replace("show", "");
                            }, 3000);
                        }
                    }).catch(function(err) {
                        console.error('ì£¼ì†Œ ë³µì‚¬ ì‹¤íŒ¨', err);
                    });
                }

                /* 7) ì‘ì›í•˜ê¸°(í­ì£½) ê¸°ëŠ¥ - window.fireConfetti()ë¡œ í˜¸ì¶œ, í­ì£½ í„°ëœ¨ë¦¬ê³  ë²„íŠ¼ í…ìŠ¤íŠ¸ ì ê¹ ë³€ê²½ */
                window.fireConfetti = function(btn) {
                    confetti({
                        particleCount: 100
                        , spread: 70
                        , origin: {y: 0.6}
                        , colors: ['#FBC02D', '#E91E63', '#4CAF50', '#2196F3']
                    });

                    const textSpan = document.getElementById('like-text');
                    if(textSpan) {
                        textSpan.innerText = "ê°ì‚¬í•©ë‹ˆë‹¤! ğŸ¥°";
                        setTimeout(() => textSpan.innerText = "ì‘ì›í•˜ê¸°", 2000);
                    }
                }

                /* 8) filtering-mode í•´ì œ - ì´ˆë°˜ ê¹œë¹¡ì„ ë°©ì§€ìš© ìˆ¨ê¹€ì„ 0.3ì´ˆ í›„ ì œê±° */
                setTimeout(()=>document.documentElement.classList.remove('filtering-mode'), 300);
            });
        </script>

        <!-- âœ… í—¤ë” include -->
        {% include header.html %}

        <!-- âœ… ë©”ì¸ ë ˆì´ì•„ì›ƒ: ì‚¬ì´ë“œë°” + ë³¸ë¬¸ -->
        <div class="container">
            {%include sidebar.html%}
            <main>{{content}}</main>
        </div>

        <!-- âœ… í‘¸í„° include -->
        {% include footer.html %}

        <!-- âœ… ê²€ìƒ‰ ëª¨ë‹¬ include -->
        {% include search.html %}
    </body>
</html>