<!DOCTYPE html>
<html lang="ko">
<head>
    {%if site.google_analytics%}
    <script async src="https://www.googletagmanager.com/gtag/js?id={{site.google_analytics}}"></script>
    <script>
      window.dataLayer=window.dataLayer||[];
      function gtag(){dataLayer.push(arguments);}
      gtag('js',new Date());
      gtag('config','{{site.google_analytics}}');
    </script>
    {%endif%}

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{page.title | default: site.title}}</title>
    <link rel="icon" type="image/png" href="{{'/assets/img/favicon.png'|relative_url}}">
    <link rel="stylesheet" href="{{'/css/butter.css'|relative_url}}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <meta property="og:site_name" content="{{site.profile.name}}">
    <meta property="og:type" content="{%if page.layout=='post'%}article{%else%}website{%endif%}">
    <meta property="og:title" content="{{page.title|default:site.title}}">
    <meta property="og:url" content="{{page.url|absolute_url}}">
    <meta property="og:description" content="{{page.excerpt|default:site.profile.description|strip_html|strip_newlines|truncate:160}}">
    {%assign og_image = site.profile.image|absolute_url%}
    {%if page.image%}{%assign og_image = page.image|absolute_url%}{%endif%}
    <meta property="og:image" content="{{og_image}}">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{page.title|default:site.title}}">
    <meta name="twitter:description" content="{{page.excerpt|default:site.profile.description|strip_html|truncate:160}}">
    <meta name="twitter:image" content="{{og_image}}">

    <style>
        html.filtering-mode body { opacity: 0; visibility: hidden; }
        body { transition: opacity 0.2s ease-in-out; opacity: 1; visibility: visible; }
    </style>
    <script>
        if (window.location.hash && window.location.hash.length > 1) {
            document.documentElement.classList.add('filtering-mode');
        }
    </script>
</head>

<body data-p-cat="{{page.categories[0]}}" data-s-cat="{{page.categories[1]}}">
    <a id="btn-back-to-top" href="#" style="display: none; position: fixed; bottom: 30px; right: 30px; width: 50px; height: 50px; background-color: #FBC02D; color: #5D4037; border-radius: 50%; box-shadow: 0 4px 10px rgba(0,0,0,0.3); text-align: center; line-height: 50px; font-size: 24px; font-weight: bold; z-index: 2147483647; border: 2px solid #fff; text-decoration: none;">â†‘</a>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // ì´ë¯¸ì§€ í™•ëŒ€
            mediumZoom('.post-body img', { margin: 24, background: 'rgba(0,0,0,0.8)' });

            // ë§¨ ìœ„ë¡œ ê°€ê¸°
            const backToTopBtn = document.getElementById("btn-back-to-top");
            if(backToTopBtn) {
                window.addEventListener("scroll", function() {
                    if(window.scrollY > 200) backToTopBtn.style.display = "block";
                    else backToTopBtn.style.display = "none";
                });
                backToTopBtn.addEventListener("click", function(e) {
                    e.preventDefault();
                    window.scrollTo({top: 0, behavior: 'smooth'});
                });
            }

            // ëŒ“ê¸€ ìˆ˜
            const repo = "tjswntjswn/tjswntjswn.github.io";
            function normalize(text) { return text ? decodeURIComponent(text).replace(/\s+/g, "").replace(/\//g, "").replace(/\.html$/g, "").toLowerCase() : ""; }
            fetch(`https://api.github.com/repos/${repo}/issues?per_page=100`).then(r=>r.json()).then(d=>{
                const m={}; if(Array.isArray(d)) d.forEach(i=>m[normalize(i.title)]=i.comments);
                document.querySelectorAll(".comment-cnt-target").forEach(e=>{
                    const u=normalize(e.getAttribute("data-url")), t=normalize(e.getAttribute("data-title"));
                    let c=m[u]!==undefined?m[u]:(m[t]!==undefined?m[t]:0);
                    e.innerHTML=`ðŸ’¬ ${c}`; if(c>0) e.style.fontWeight="bold"; e.style.opacity=1;
                });
            }).catch(e=>console.log("ëŒ“ê¸€ ë¡œë”© ì‹¤íŒ¨:",e));

            // ì‚¬ì´ë“œë°” í•˜ì´ë¼ì´íŠ¸
            function highlightSidebar() {
                document.querySelectorAll('.category-tree a').forEach(a=>a.classList.remove('active-category'));
                const h=decodeURIComponent(window.location.hash).replace('#','');
                const p=document.body.getAttribute('data-p-cat'), s=document.body.getAttribute('data-s-cat');
                let t = h ? h : (s ? s : p);
                if(t) document.querySelectorAll('.category-tree a').forEach(a=>{ if(decodeURIComponent(a.getAttribute('href')).includes('#'+t)) a.classList.add('active-category'); });
            }
            highlightSidebar();
            window.addEventListener('hashchange', highlightSidebar);

            // ì½”ë“œ ë³µì‚¬
            document.querySelectorAll('pre.highlight').forEach(pre=>{
                var btn=document.createElement('button'); btn.className='btn-copy-code'; btn.textContent='Copy';
                btn.addEventListener('click', function() {
                    navigator.clipboard.writeText(pre.querySelector('code').innerText).then(()=>{
                        btn.textContent='Copied! âœ¨'; setTimeout(()=>btn.textContent='Copy',2000);
                    });
                });
                if(pre.parentNode) pre.parentNode.appendChild(btn);
            });

            // [ì¶”ê°€] ê³µìœ í•˜ê¸° ê¸°ëŠ¥ (ì£¼ì†Œ ë³µì‚¬ + í† ìŠ¤íŠ¸ ë©”ì‹œì§€)
            window.copyLink = function() {
                const url = window.location.href;
                navigator.clipboard.writeText(url).then(function() {
                    const toast = document.getElementById("toast-msg");
                    if(toast) {
                        toast.className = "show";
                        setTimeout(function(){ toast.className = toast.className.replace("show", ""); }, 3000);
                    }
                }).catch(function(err) { console.error('ì£¼ì†Œ ë³µì‚¬ ì‹¤íŒ¨', err); });
            }

            // [ì¶”ê°€] ì‘ì›í•˜ê¸°(í­ì£½) ê¸°ëŠ¥
            window.fireConfetti = function(btn) {
                // íŽ‘! í„°ì§€ëŠ” íš¨ê³¼
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: ['#FBC02D', '#E91E63', '#4CAF50', '#2196F3']
                });
                
                // ë²„íŠ¼ ê¸€ìž ë°”ê¾¸ê¸° (ì‘ì› ê°ì‚¬í•©ë‹ˆë‹¤!)
                const textSpan = document.getElementById('like-text');
                if(textSpan) {
                    textSpan.innerText = "ê°ì‚¬í•©ë‹ˆë‹¤! ðŸ¥°";
                    setTimeout(() => textSpan.innerText = "ì‘ì›í•˜ê¸°", 2000);
                }
            }

            setTimeout(()=>document.documentElement.classList.remove('filtering-mode'),300);
        });
    </script>
    {% include header.html %}
    <div class="container">
        {%include sidebar.html%}
        <main>{{content}}</main>
    </div>
    {% include footer.html %}
    {% include search.html %}
</body>
</html>