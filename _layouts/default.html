<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>{{page.title | default: site.title}}</title>
        
        <link rel="icon" type="image/png" href="{{'/assets/img/favicon.png'|relative_url}}">
        
        <link rel="stylesheet" href="{{'/css/butter.css'|relative_url}}">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
        <meta property="og:site_name" content="{{site.profile.name}}">
        <meta property="og:type" content="{%if page.layout=='post'%}article{%else%}website{%endif%}">
        <meta property="og:title" content="{{page.title|default:site.title}}">
        <meta property="og:url" content="{{page.url|absolute_url}}">
        <meta property="og:description" content="{{page.excerpt|default:site.profile.description|strip_html|strip_newlines|truncate:160}}">
    
        {%assign og_image = site.profile.image|absolute_url%}
        {%if page.image%}
          {%assign og_image = page.image|absolute_url%}
        {%endif%}
        <meta property="og:image" content="{{og_image}}">
    
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="{{page.title|default:site.title}}">
        <meta name="twitter:description" content="{{page.excerpt|default:site.profile.description|strip_html|truncate:160}}">
        <meta name="twitter:image" content="{{og_image}}">
    </head>
    <body data-p-cat="{{page.categories[0]}}" data-s-cat="{{page.categories[1]}}">
    <a id="btn-back-to-top" href="#" style="display: none; position: fixed; bottom: 30px; right: 30px; width: 50px; height: 50px; background-color: #FBC02D; color: #5D4037; border-radius: 50%; box-shadow: 0 4px 10px rgba(0,0,0,0.3); text-align: center; line-height: 50px; font-size: 24px; font-weight: bold; z-index: 2147483647; border: 2px solid #fff; text-decoration: none;">â†‘</a>
    <script>
        document.addEventListener("DOMContentLoaded", function() {

        // --- 1. ë§¨ ìœ„ë¡œ ê°€ê¸° ê¸°ëŠ¥ ---
        const backToTopBtn = document.getElementById("btn-back-to-top");
        if(backToTopBtn) {
            window.addEventListener("scroll", function() {
                if(window.scrollY > 200) backToTopBtn.style.display = "block";
                else backToTopBtn.style.display = "none";
            });
            backToTopBtn.addEventListener("click", function(e) {
                e.preventDefault();
                window.scrollTo({top: 0, behavior: 'smooth'});
            });
        }

        // --- 2. ëŒ“ê¸€ ê°¯ìˆ˜ ê¸°ëŠ¥ ---
        const repo = "tjswntjswn/tjswntjswn.github.io";
        function normalize(text) {
            if(!text) return "";
            return decodeURIComponent(text).replace(/\s+/g, "").replace(/\//g, "").replace(/\.html$/g, "").toLowerCase();
        }

        fetch(`https://api.github.com/repos/${repo}/issues?per_page=100`)
            .then(response => response.json())
            .then(data => {
                const issueMap = {};
                if(Array.isArray(data)) {
                    data.forEach(issue => {
                        const key = normalize(issue.title);
                        issueMap[key] = issue.comments;
                    });
                }
                document.querySelectorAll(".comment-cnt-target").forEach(el => {
                    const urlKey = normalize(el.getAttribute("data-url"));
                    const titleKey = normalize(el.getAttribute("data-title"));
                    let count = 0;
                    if(issueMap[urlKey] !== undefined) count = issueMap[urlKey];
                    else if(issueMap[titleKey] !== undefined) count = issueMap[titleKey];
                    
                    el.innerHTML = `ğŸ’¬ ${count}`;
                    if (count > 0) el.style.fontWeight = "bold";
                    el.style.opacity = 1;
                });
            })
            .catch(err => console.log("ëŒ“ê¸€ ë¡œë”© ì‹¤íŒ¨:", err));

        // --- 3. ì‚¬ì´ë“œë°” í˜„ì¬ ìœ„ì¹˜ í•˜ì´ë¼ì´íŠ¸ (ìµœì¢…_ì‹¬í”Œ_ë²„ì „) ---
        function highlightSidebar() {
            // 1. ì´ˆê¸°í™” (ëª¨ë‘ ë„ê¸°)
            document.querySelectorAll('.category-tree a').forEach(a => {
                a.classList.remove('active-category');
            });

            // 2. ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const hash = decodeURIComponent(window.location.hash).replace('#', ''); // ì£¼ì†Œì°½ í•´ì‹œ
            const pCat = document.body.getAttribute('data-p-cat'); // ë³¸ë¬¸ ìƒìœ„ ì¹´í…Œê³ ë¦¬
            const sCat = document.body.getAttribute('data-s-cat'); // ë³¸ë¬¸ í•˜ìœ„ ì¹´í…Œê³ ë¦¬

            let target = "";
            
            // 3. íƒ€ê²Ÿ ì„ ì • ë¡œì§ (ìš°ì„ ìˆœìœ„ ì ìš©)
            if (hash) {
                // Case A: ë©”ë‰´ë¥¼ ì§ì ‘ í´ë¦­í–ˆì„ ë•Œ (í•´ì‹œê°’ ë¬´ì¡°ê±´ ë”°ë¦„)
                target = hash;
            } else {
                // Case B: ê²Œì‹œê¸€ì„ ë³´ê³  ìˆì„ ë•Œ (í•˜ìœ„ ì¹´í…Œê³ ë¦¬ê°€ ìˆìœ¼ë©´ í•˜ìœ„ë§Œ, ì—†ìœ¼ë©´ ìƒìœ„ ì„ íƒ)
                if (sCat && sCat !== "") {
                    target = sCat; // ìì‹ì´ ìˆìœ¼ë©´ ìì‹ë§Œ íƒ€ê²Ÿ!
                } else if (pCat && pCat !== "") {
                    target = pCat; // ìì‹ì´ ì—†ìœ¼ë©´ ë¶€ëª¨ íƒ€ê²Ÿ!
                }
            }

            // 4. í•˜ë‚˜ë§Œ ì¼œê¸°
            if(target) {
                document.querySelectorAll('.category-tree a').forEach(a => {
                    // ë§í¬ ì£¼ì†Œê°€ íƒ€ê²Ÿê³¼ ì •í™•íˆ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸ (#íƒ€ê²Ÿ)
                    if(decodeURIComponent(a.getAttribute('href')).includes('#' + target)) {
                        a.classList.add('active-category');
                    }
                });
            }
        }

        // ì‹¤í–‰ íŠ¸ë¦¬ê±°
        highlightSidebar();
        window.addEventListener('hashchange', highlightSidebar);

    });
    </script>
    {%include header.html%}
    <div class="container">
        {%include sidebar.html%}
        <main>{{content}}</main>
    </div>
    {%include footer.html%}
</body>
</html>